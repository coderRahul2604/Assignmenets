{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock css %}

{% block content %}
<div class="message">
    {% for message in messages %}
    <div class="alert {{ message.tags }}">
        <strong>Message: </strong> {{ message }}
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    </div>
    {% endfor %}
</div>
<div class="main">
    <div class="heading">
        <h1>Welcome Back {{ user_info.first_name }} {{ user_info.last_name }}</h1>
        <form action="{% url 'logout' %}" method="post" style="display: inline;">
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>
    </div>
    <div class="information">
        <div class="infoBox">
            <b>
                <h3>Username: {{ user_info.username }}</h3>
                <p>Email: {{ user_info.email }}</p>
                <p>User Type: {% if user_info.is_patient %} Patient {% elif user_info.is_doctor %} Doctor {% endif %}</p>
                <p>Address: {{ user_info.address_line1 }}, {{ user_info.city }}, {{ user_info.state }} - {{ user_info.pincode }}</p>
            </b>
        </div>
    </div>
    {% if user.is_authenticated and user.is_doctor %}
    <div class="main">
        <h1>My Blog Posts</h1>
        <ul>
            {% for blog_post in my_blogs %}
            <li>
                <h2>{{ blog_post.title }}</h2>
                {% if blog_post.image %}
                    <img src="{{ blog_post.image.url }}" alt="{{ blog_post.title }}" style="width:20%; height: 120px;">
                {% else %}
                    <p>No image available</p>
                {% endif %}
                <p>{{ blog_post.summary|truncatewords:15 }}</p>
                <p>Created at: {{ blog_post.created_at }}</p>
                <p>Status: {% if blog_post.is_draft %}Draft{% else %}Published{% endif %}</p>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

<script>
    var messages = document.querySelectorAll('.message .alert')

    messages.forEach(function (message) {
        setTimeout(function () {
            message.style.display = 'none'
        }, 5000)
    })
</script>
{% endblock %}
